

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Run BigDFT and manipulate its output files &mdash; My_BigDFT  documentation</title>
  

  
  
  
  

  
  <script type="text/javascript" src="../_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
        <script type="text/javascript" src="../_static/jquery.js"></script>
        <script type="text/javascript" src="../_static/underscore.js"></script>
        <script type="text/javascript" src="../_static/doctools.js"></script>
        <script type="text/javascript" src="../_static/language_data.js"></script>
        <script async="async" type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
        <script type="text/x-mathjax-config">MathJax.Hub.Config({"tex2jax": {"inlineMath": [["$", "$"], ["\\(", "\\)"]], "processEscapes": true, "ignoreClass": "document", "processClass": "math|output_area"}})</script>
    
    <script type="text/javascript" src="../_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Convergence classes" href="Convergences.html" />
    <link rel="prev" title="Manipulate BigDFT input files" href="Input_files.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../index.html" class="icon icon-home"> My_BigDFT
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../code_doc.html">Code Documentation</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../tutorials.html">MyBigDFT tutorials</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="Input_files.html">Manipulate BigDFT input files</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">Run BigDFT and manipulate its output files</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#The-Logfile-class">The Logfile class</a></li>
<li class="toctree-l3"><a class="reference internal" href="#The-Job-class">The Job class</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#Force-the-calculation-to-run">Force the calculation to run</a></li>
<li class="toctree-l4"><a class="reference internal" href="#What-if-the-run-fails?">What if the run fails?</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="Convergences.html">Convergence classes</a></li>
<li class="toctree-l2"><a class="reference internal" href="PolTensor.html">Compute the electronic polarizability tensor</a></li>
<li class="toctree-l2"><a class="reference internal" href="Phonons_and_RamanSpectrum.html">Compute the phonons and the Raman spectrum</a></li>
<li class="toctree-l2"><a class="reference internal" href="Phonons_and_InfraredSpectrum.html">Compute the phonons and the infrared spectrum</a></li>
<li class="toctree-l2"><a class="reference internal" href="VibPolTensor.html">Compute the vibrational polarizability tensor</a></li>
<li class="toctree-l2"><a class="reference internal" href="Dissociation_curve.html">Dissociation curve</a></li>
<li class="toctree-l2"><a class="reference internal" href="Geopt.html">Geometry optimization</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../exercises.html">Exercises</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">My_BigDFT</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html">Docs</a> &raquo;</li>
        
          <li><a href="../tutorials.html">MyBigDFT tutorials</a> &raquo;</li>
        
      <li>Run BigDFT and manipulate its output files</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../_sources/notebooks/Job_and_Logfile.ipynb.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  
<style>
/* CSS for nbsphinx extension */

/* remove conflicting styling from Sphinx themes */
div.nbinput,
div.nbinput div.prompt,
div.nbinput div.input_area,
div.nbinput div[class*=highlight],
div.nbinput div[class*=highlight] pre,
div.nboutput,
div.nbinput div.prompt,
div.nbinput div.output_area,
div.nboutput div[class*=highlight],
div.nboutput div[class*=highlight] pre {
    background: none;
    border: none;
    padding: 0 0;
    margin: 0;
    box-shadow: none;
}

/* avoid gaps between output lines */
div.nboutput div[class*=highlight] pre {
    line-height: normal;
}

/* input/output containers */
div.nbinput,
div.nboutput {
    display: -webkit-flex;
    display: flex;
    align-items: flex-start;
    margin: 0;
    width: 100%;
}
@media (max-width: 540px) {
    div.nbinput,
    div.nboutput {
        flex-direction: column;
    }
}

/* input container */
div.nbinput {
    padding-top: 5px;
}

/* last container */
div.nblast {
    padding-bottom: 5px;
}

/* input prompt */
div.nbinput div.prompt pre {
    color: #307FC1;
}

/* output prompt */
div.nboutput div.prompt pre {
    color: #BF5B3D;
}

/* all prompts */
div.nbinput div.prompt,
div.nboutput div.prompt {
    min-width: 5ex;
    padding-top: 0.4em;
    padding-right: 0.4em;
    text-align: right;
    flex: 0;
}
@media (max-width: 540px) {
    div.nbinput div.prompt,
    div.nboutput div.prompt {
        text-align: left;
        padding: 0.4em;
    }
    div.nboutput div.prompt.empty {
        padding: 0;
    }
}

/* disable scrollbars on prompts */
div.nbinput div.prompt pre,
div.nboutput div.prompt pre {
    overflow: hidden;
}

/* input/output area */
div.nbinput div.input_area,
div.nboutput div.output_area {
    padding: 0.4em;
    -webkit-flex: 1;
    flex: 1;
    overflow: auto;
}
@media (max-width: 540px) {
    div.nbinput div.input_area,
    div.nboutput div.output_area {
        width: 100%;
    }
}

/* input area */
div.nbinput div.input_area {
    border: 1px solid #e0e0e0;
    border-radius: 2px;
    background: #f5f5f5;
}

/* override MathJax center alignment in output cells */
div.nboutput div[class*=MathJax] {
    text-align: left !important;
}

/* override sphinx.ext.imgmath center alignment in output cells */
div.nboutput div.math p {
    text-align: left;
}

/* standard error */
div.nboutput div.output_area.stderr {
    background: #fdd;
}

/* ANSI colors */
.ansi-black-fg { color: #3E424D; }
.ansi-black-bg { background-color: #3E424D; }
.ansi-black-intense-fg { color: #282C36; }
.ansi-black-intense-bg { background-color: #282C36; }
.ansi-red-fg { color: #E75C58; }
.ansi-red-bg { background-color: #E75C58; }
.ansi-red-intense-fg { color: #B22B31; }
.ansi-red-intense-bg { background-color: #B22B31; }
.ansi-green-fg { color: #00A250; }
.ansi-green-bg { background-color: #00A250; }
.ansi-green-intense-fg { color: #007427; }
.ansi-green-intense-bg { background-color: #007427; }
.ansi-yellow-fg { color: #DDB62B; }
.ansi-yellow-bg { background-color: #DDB62B; }
.ansi-yellow-intense-fg { color: #B27D12; }
.ansi-yellow-intense-bg { background-color: #B27D12; }
.ansi-blue-fg { color: #208FFB; }
.ansi-blue-bg { background-color: #208FFB; }
.ansi-blue-intense-fg { color: #0065CA; }
.ansi-blue-intense-bg { background-color: #0065CA; }
.ansi-magenta-fg { color: #D160C4; }
.ansi-magenta-bg { background-color: #D160C4; }
.ansi-magenta-intense-fg { color: #A03196; }
.ansi-magenta-intense-bg { background-color: #A03196; }
.ansi-cyan-fg { color: #60C6C8; }
.ansi-cyan-bg { background-color: #60C6C8; }
.ansi-cyan-intense-fg { color: #258F8F; }
.ansi-cyan-intense-bg { background-color: #258F8F; }
.ansi-white-fg { color: #C5C1B4; }
.ansi-white-bg { background-color: #C5C1B4; }
.ansi-white-intense-fg { color: #A1A6B2; }
.ansi-white-intense-bg { background-color: #A1A6B2; }

.ansi-default-inverse-fg { color: #FFFFFF; }
.ansi-default-inverse-bg { background-color: #000000; }

.ansi-bold { font-weight: bold; }
.ansi-underline { text-decoration: underline; }

/* Some additional styling taken form the Jupyter notebook CSS */
div.rendered_html table {
  border: none;
  border-collapse: collapse;
  border-spacing: 0;
  color: black;
  font-size: 12px;
  table-layout: fixed;
}
div.rendered_html thead {
  border-bottom: 1px solid black;
  vertical-align: bottom;
}
div.rendered_html tr,
div.rendered_html th,
div.rendered_html td {
  text-align: right;
  vertical-align: middle;
  padding: 0.5em 0.5em;
  line-height: normal;
  white-space: normal;
  max-width: none;
  border: none;
}
div.rendered_html th {
  font-weight: bold;
}
div.rendered_html tbody tr:nth-child(odd) {
  background: #f5f5f5;
}
div.rendered_html tbody tr:hover {
  background: rgba(66, 165, 245, 0.2);
}

/* CSS overrides for sphinx_rtd_theme */

/* 24px margin */
.nbinput.nblast,
.nboutput.nblast {
    margin-bottom: 19px;  /* padding has already 5px */
}

/* ... except between code cells! */
.nblast + .nbinput {
    margin-top: -19px;
}

.admonition > p:before {
    margin-right: 4px;  /* make room for the exclamation icon */
}

/* Fix math alignment, see https://github.com/rtfd/sphinx_rtd_theme/pull/686 */
.math {
    text-align: unset;
}
</style>
<div class="section" id="Run-BigDFT-and-manipulate-its-output-files">
<h1>Run BigDFT and manipulate its output files<a class="headerlink" href="#Run-BigDFT-and-manipulate-its-output-files" title="Permalink to this headline">¶</a></h1>
<p>After the <a class="reference external" href="https://mmoriniere.gitlab.io/MyBigDFT/notebooks/Input_files.html">presentation of the BigDFT input files</a>, it now time run actual BigDFT calculations with MyBigDFT. This is made possible via the <a class="reference external" href="https://mmoriniere.gitlab.io/MyBigDFT/job.html">Job</a> class.</p>
<p>The result of a BigDFT calculation is stored in a logfile using the YAML format (just like the input file). The <a class="reference external" href="https://mmoriniere.gitlab.io/MyBigDFT/logfile.html#logfile">Logfile</a> class is meant to ease the manipulation of this output data.</p>
<div class="section" id="The-Logfile-class">
<h2>The <a class="reference external" href="https://mmoriniere.gitlab.io/MyBigDFT/logfile.html#logfile">Logfile</a> class<a class="headerlink" href="#The-Logfile-class" title="Permalink to this headline">¶</a></h2>
<p>As a first example, you can read an already existing logfile via the <code class="docutils literal notranslate"><span class="pre">from_file</span></code> method. It only requires the path to an already existing logfile:</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[1]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="kn">from</span> <span class="nn">mybigdft</span> <span class="k">import</span> <span class="n">Logfile</span>
<span class="n">log</span> <span class="o">=</span> <span class="n">Logfile</span><span class="o">.</span><span class="n">from_file</span><span class="p">(</span><span class="s2">&quot;../../../tests/log.yaml&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<p>You can get the input parameters used to run the calculation via the <code class="docutils literal notranslate"><span class="pre">inputparams</span></code> attribute:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[2]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">inp</span> <span class="o">=</span> <span class="n">log</span><span class="o">.</span><span class="n">inputparams</span>
<span class="nb">print</span><span class="p">(</span><span class="n">inp</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
{}
</pre></div></div>
</div>
<p>Here, default parameters were used.</p>
<p>You can also get the initial positions used via the <code class="docutils literal notranslate"><span class="pre">posinp</span></code> attribute:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[3]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">pos</span> <span class="o">=</span> <span class="n">log</span><span class="o">.</span><span class="n">posinp</span>
<span class="nb">print</span><span class="p">(</span><span class="n">pos</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
2   angstroem
free
N   2.97630782434901e-23   6.87220595204354e-23   0.0107161998748779
N  -1.10434491945017e-23  -4.87342174483075e-23   1.10427379608154

</pre></div></div>
</div>
<p>The same <code class="docutils literal notranslate"><span class="pre">Posinp</span></code> instance is actually stored under the <code class="docutils literal notranslate"><span class="pre">posinp</span></code> attribute of the input parameters:</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[4]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="k">assert</span> <span class="n">inp</span><span class="o">.</span><span class="n">posinp</span> <span class="o">==</span> <span class="n">log</span><span class="o">.</span><span class="n">posinp</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="The-Job-class">
<h2>The <a class="reference external" href="https://mmoriniere.gitlab.io/MyBigDFT/job.html">Job</a> class<a class="headerlink" href="#The-Job-class" title="Permalink to this headline">¶</a></h2>
<p>To run a calculation, use the <code class="docutils literal notranslate"><span class="pre">Job</span></code> class. It requires the input geometry (given by the input parameters or by the posinp) and generally some input parameters. You may also provide a name to the calculation, so as to set the name for the input and output files. You can also define where to run the calculation by specifying the <code class="docutils literal notranslate"><span class="pre">run_dir</span></code> argument.</p>
<p>Finally, the most important thing to know about the <code class="docutils literal notranslate"><span class="pre">Job</span></code> class is that it must be used with a context manager. This ensures that the files are created in the correct location and that the BigDFT calculation is run in the same location.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[5]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="kn">from</span> <span class="nn">mybigdft</span> <span class="k">import</span> <span class="n">Job</span>
<span class="kn">import</span> <span class="nn">os</span>

<span class="c1"># No need to provide a posinp explicitly, since it is stored in inp</span>
<span class="c1"># under the `posinp` attribute.</span>
<span class="k">with</span> <span class="n">Job</span><span class="p">(</span><span class="n">inputparams</span><span class="o">=</span><span class="n">inp</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;test&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">job</span><span class="p">:</span>
    <span class="c1"># The calculation must be run in the context manager.</span>
    <span class="c1"># Here, it uses 6 processors and 3 OpenMP threads.</span>
    <span class="n">job</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">nmpi</span><span class="o">=</span><span class="mi">6</span><span class="p">,</span> <span class="n">nomp</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">dry_run</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="c1"># Setting dry_run to True runs bigdft-tool instead of</span>
    <span class="c1"># bigdft and creates the input files. This is a good way</span>
    <span class="c1"># of testing the input parameters and positions before</span>
    <span class="c1"># running the actual BigDFT calculation.</span>
    <span class="k">assert</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="s2">&quot;test.yaml&quot;</span><span class="p">)</span>
    <span class="k">assert</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="s2">&quot;test.xyz&quot;</span><span class="p">)</span>
    <span class="c1"># A logfile is also created, containing the output of the</span>
    <span class="c1"># bigdft-tool run. You can check it to get an estimation</span>
    <span class="c1"># of the memory requirement of the calculation.</span>
    <span class="k">assert</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="s2">&quot;log-test.yaml&quot;</span><span class="p">)</span>
    <span class="c1"># The input and output files can also be removed from the</span>
    <span class="c1"># disk. This must be performed in the context manager as</span>
    <span class="c1"># well, by running the clean method. However, you generally</span>
    <span class="c1"># do not want to erase your output files after running the</span>
    <span class="c1"># calculation.</span>
    <span class="n">job</span><span class="o">.</span><span class="n">clean</span><span class="p">()</span>
    <span class="k">assert</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="s2">&quot;log-test.yaml&quot;</span><span class="p">)</span>
    <span class="k">assert</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="s2">&quot;test.yaml&quot;</span><span class="p">)</span>
    <span class="k">assert</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="s2">&quot;test.xyz&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
/Users/maximemoriniere/Documents/Python/MyBigDFT/doc/source/notebooks
/Users/maximemoriniere/Documents/bigdft/bigdft/build-1997/install/bin/bigdft-tool --name test -n 6 ...
</pre></div></div>
</div>
<p>Note that you can still use <code class="docutils literal notranslate"><span class="pre">job</span></code> after exiting the context manager. It is for instance possible to look for some attributes of the output of the bigdft-tool executable, and compare them to those of the base logfile used to initialize the input parameters and geometry:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[6]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="k">for</span> <span class="n">attr</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;energy&quot;</span><span class="p">,</span> <span class="s2">&quot;dipole&quot;</span><span class="p">,</span> <span class="s2">&quot;inputparams&quot;</span><span class="p">,</span> <span class="s2">&quot;posinp&quot;</span><span class="p">]:</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">f</span><span class="s2">&quot;</span><span class="si">{attr}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">f</span><span class="s2">&quot;   job: {getattr(job.logfile, attr)}&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">f</span><span class="s2">&quot;   log: {getattr(log, attr)}&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
energy
   job: None
   log: -19.884659235401838
dipole
   job: None
   log: [-0.00051199, -0.00051199, -0.00055711]
inputparams
   job: {}
   log: {}
posinp
   job: 2   angstroem
free
N   2.97630782434901e-23   6.87220595204354e-23   0.0107161998748779
N  -1.10434491945017e-23  -4.87342174483075e-23   1.10427379608154

   log: 2   angstroem
free
N   2.97630782434901e-23   6.87220595204354e-23   0.0107161998748779
N  -1.10434491945017e-23  -4.87342174483075e-23   1.10427379608154

</pre></div></div>
</div>
<p>Note that the output of the bigdft-tool do not give the energy nor the dipole of the system: to run the actual bigdft calculation, you must not set dry_run to <code class="docutils literal notranslate"><span class="pre">True</span></code> (see below). However, the input parameters and the initial positions are exactly the same as those of the base logfile, as expected!</p>
<p>To run the bigdft executable, you must therefore run the following code:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[7]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="k">with</span> <span class="n">Job</span><span class="p">(</span><span class="n">inputparams</span><span class="o">=</span><span class="n">inp</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;test&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">job</span><span class="p">:</span>
    <span class="k">assert</span> <span class="ow">not</span> <span class="n">job</span><span class="o">.</span><span class="n">is_completed</span>
    <span class="n">job</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">nmpi</span><span class="o">=</span><span class="mi">6</span><span class="p">,</span> <span class="n">nomp</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
    <span class="k">assert</span> <span class="n">job</span><span class="o">.</span><span class="n">is_completed</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
/Users/maximemoriniere/Documents/Python/MyBigDFT/doc/source/notebooks
mpirun -np 6 /Users/maximemoriniere/Documents/bigdft/bigdft/build-1997/install/bin/bigdft test ...
 &lt;BigDFT&gt; log of the run will be written in logfile: ./log-test.yaml

</pre></div></div>
</div>
<p>Now, the output of the calculation is the same as the base logfile, up to some numerical noise:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[8]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="k">for</span> <span class="n">attr</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;energy&quot;</span><span class="p">,</span> <span class="s2">&quot;dipole&quot;</span><span class="p">]:</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">f</span><span class="s2">&quot;</span><span class="si">{attr}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">f</span><span class="s2">&quot;   job: {getattr(job.logfile, attr)}&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">f</span><span class="s2">&quot;   log: {getattr(log, attr)}&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
energy
   job: -19.884659235399404
   log: -19.884659235401838
dipole
   job: [-0.00051199, -0.00051199, -0.00055711]
   log: [-0.00051199, -0.00051199, -0.00055711]
</pre></div></div>
</div>
<div class="section" id="Force-the-calculation-to-run">
<h3>Force the calculation to run<a class="headerlink" href="#Force-the-calculation-to-run" title="Permalink to this headline">¶</a></h3>
<p>The default behaviour of the <code class="docutils literal notranslate"><span class="pre">run</span></code> method is to read an already existing logfile instead of actually running the calculation again:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[9]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="k">with</span> <span class="n">Job</span><span class="p">(</span><span class="n">inputparams</span><span class="o">=</span><span class="n">inp</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;test&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">job</span><span class="p">:</span>
    <span class="n">job</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">nmpi</span><span class="o">=</span><span class="mi">6</span><span class="p">,</span> <span class="n">nomp</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
/Users/maximemoriniere/Documents/Python/MyBigDFT/doc/source/notebooks
Logfile log-test.yaml already exists!

</pre></div></div>
</div>
<p>You can force to run the calculation by setting the <code class="docutils literal notranslate"><span class="pre">force_run</span></code> argument of the <code class="docutils literal notranslate"><span class="pre">run</span></code> method to <code class="docutils literal notranslate"><span class="pre">True</span></code>. This forces to run the calculation even though a logfile already exists.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[10]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="k">with</span> <span class="n">Job</span><span class="p">(</span><span class="n">inputparams</span><span class="o">=</span><span class="n">inp</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;test&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">job</span><span class="p">:</span>
    <span class="c1"># The calculation is forced to run: the previous logfile</span>
    <span class="c1"># is moved to the logfiles directory (created for the occasion).</span>
    <span class="n">job</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">nmpi</span><span class="o">=</span><span class="mi">6</span><span class="p">,</span> <span class="n">nomp</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">force_run</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="c1"># You can remove the logfiles directory as well</span>
    <span class="n">job</span><span class="o">.</span><span class="n">clean</span><span class="p">(</span><span class="n">logfiles_dir</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">assert</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isdir</span><span class="p">(</span><span class="s2">&quot;logfiles&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
/Users/maximemoriniere/Documents/Python/MyBigDFT/doc/source/notebooks
mpirun -np 6 /Users/maximemoriniere/Documents/bigdft/bigdft/build-1997/install/bin/bigdft test ...
 &lt;BigDFT&gt; log of the run will be written in logfile: ./log-test.yaml
 &lt;BigDFT&gt; Logfile existing, renamed into: ./logfiles/log-test.17:04:17.065.yaml

</pre></div></div>
</div>
</div>
<div class="section" id="What-if-the-run-fails?">
<h3>What if the run fails?<a class="headerlink" href="#What-if-the-run-fails?" title="Permalink to this headline">¶</a></h3>
<p>The run or dry_run should both fail if invalid input parameters are caught by the initialization procedure. Here, we take the example of a case where the user wanted to use surface boundary conditions but placed the “.inf” as the cell size along the <span class="math notranslate nohighlight">\(z\)</span> direction (instead of the <span class="math notranslate nohighlight">\(y\)</span> direction). Note that the error message prints the actual error message received when running the bigdft-tool or bigdft executable (depending on the value of <code class="docutils literal notranslate"><span class="pre">dry_run</span></code>).</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[11]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="kn">from</span> <span class="nn">mybigdft</span> <span class="k">import</span> <span class="n">InputParams</span>

<span class="n">inp</span> <span class="o">=</span> <span class="n">InputParams</span><span class="p">({</span><span class="s2">&quot;posinp&quot;</span><span class="p">:</span> <span class="p">{</span>
    <span class="s2">&quot;units&quot;</span><span class="p">:</span> <span class="s2">&quot;angstroem&quot;</span><span class="p">,</span>
    <span class="s2">&quot;cell&quot;</span><span class="p">:</span> <span class="p">[</span><span class="mi">40</span><span class="p">,</span> <span class="mi">40</span><span class="p">,</span> <span class="s2">&quot;.inf&quot;</span><span class="p">],</span>
    <span class="s2">&quot;positions&quot;</span><span class="p">:</span> <span class="p">[</span>
        <span class="p">{</span><span class="s1">&#39;N&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mf">2.97630782434901e-23</span><span class="p">,</span> <span class="mf">6.87220595204354e-23</span><span class="p">,</span> <span class="mf">0.0107161998748779</span><span class="p">]},</span>
        <span class="p">{</span><span class="s1">&#39;N&#39;</span><span class="p">:</span> <span class="p">[</span><span class="o">-</span><span class="mf">1.10434491945017e-23</span><span class="p">,</span> <span class="o">-</span><span class="mf">4.87342174483075e-23</span><span class="p">,</span> <span class="mf">1.10427379608154</span><span class="p">]},</span>
    <span class="p">]</span>
<span class="p">}})</span>

<span class="k">with</span> <span class="n">Job</span><span class="p">(</span><span class="n">inputparams</span><span class="o">=</span><span class="n">inp</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;test&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">job</span><span class="p">:</span>
    <span class="n">job</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">nmpi</span><span class="o">=</span><span class="mi">6</span><span class="p">,</span> <span class="n">nomp</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">dry_run</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">job</span><span class="o">.</span><span class="n">clean</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
/Users/maximemoriniere/Documents/Python/MyBigDFT/doc/source/notebooks
/Users/maximemoriniere/Documents/bigdft/bigdft/build-1997/install/bin/bigdft-tool --name test -n 6 ...
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
<span class="ansi-red-fg">---------------------------------------------------------------------------</span>
<span class="ansi-red-fg">RuntimeError</span>                              Traceback (most recent call last)
<span class="ansi-green-fg">&lt;ipython-input-11-111fe3f096f8&gt;</span> in <span class="ansi-cyan-fg">&lt;module&gt;</span><span class="ansi-blue-fg">()</span>
<span class="ansi-green-intense-fg ansi-bold">     11</span>
<span class="ansi-green-intense-fg ansi-bold">     12</span> <span class="ansi-green-fg">with</span> Job<span class="ansi-blue-fg">(</span>inputparams<span class="ansi-blue-fg">=</span>inp<span class="ansi-blue-fg">,</span> name<span class="ansi-blue-fg">=</span><span class="ansi-blue-fg">&#34;test&#34;</span><span class="ansi-blue-fg">)</span> <span class="ansi-green-fg">as</span> job<span class="ansi-blue-fg">:</span>
<span class="ansi-green-fg">---&gt; 13</span><span class="ansi-red-fg">     </span>job<span class="ansi-blue-fg">.</span>run<span class="ansi-blue-fg">(</span>nmpi<span class="ansi-blue-fg">=</span><span class="ansi-cyan-fg">6</span><span class="ansi-blue-fg">,</span> nomp<span class="ansi-blue-fg">=</span><span class="ansi-cyan-fg">3</span><span class="ansi-blue-fg">,</span> dry_run<span class="ansi-blue-fg">=</span><span class="ansi-green-fg">True</span><span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">     14</span>     job<span class="ansi-blue-fg">.</span>clean<span class="ansi-blue-fg">(</span><span class="ansi-blue-fg">)</span>

<span class="ansi-green-fg">~/Documents/Python/MyBigDFT/mybigdft/job.py</span> in <span class="ansi-cyan-fg">run</span><span class="ansi-blue-fg">(self, nmpi, nomp, force_run, dry_run)</span>
<span class="ansi-green-intense-fg ansi-bold">    453</span>             self<span class="ansi-blue-fg">.</span>write_input_files<span class="ansi-blue-fg">(</span><span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">    454</span>             command <span class="ansi-blue-fg">=</span> self<span class="ansi-blue-fg">.</span>_get_command<span class="ansi-blue-fg">(</span>nmpi<span class="ansi-blue-fg">,</span> dry_run<span class="ansi-blue-fg">)</span>
<span class="ansi-green-fg">--&gt; 455</span><span class="ansi-red-fg">             </span>output_msg <span class="ansi-blue-fg">=</span> self<span class="ansi-blue-fg">.</span>_launch_calculation<span class="ansi-blue-fg">(</span>command<span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">    456</span>             <span class="ansi-green-fg">if</span> dry_run<span class="ansi-blue-fg">:</span>
<span class="ansi-green-intense-fg ansi-bold">    457</span>                 self<span class="ansi-blue-fg">.</span>_write_bigdft_tool_output<span class="ansi-blue-fg">(</span>output_msg<span class="ansi-blue-fg">)</span>

<span class="ansi-green-fg">~/Documents/Python/MyBigDFT/mybigdft/job.py</span> in <span class="ansi-cyan-fg">_launch_calculation</span><span class="ansi-blue-fg">(command)</span>
<span class="ansi-green-intense-fg ansi-bold">    644</span>             raise RuntimeError(
<span class="ansi-green-intense-fg ansi-bold">    645</span>                 <span class="ansi-blue-fg">&#34;The calculation ended with the following error message:{}&#34;</span>
<span class="ansi-green-fg">--&gt; 646</span><span class="ansi-red-fg">                 .format(error_msg))
</span><span class="ansi-green-intense-fg ansi-bold">    647</span>         <span class="ansi-green-fg">return</span> out
<span class="ansi-green-intense-fg ansi-bold">    648</span>

<span class="ansi-red-fg">RuntimeError</span>: The calculation ended with the following error message:
 abi_symdet: ERROR -
  Abs(determinant) for symmetry number    1 is         0 .
  For a legitimate symmetry, abs(determinant) must be 1.
  Action : check your symmetry operations (symrel) in input file.
Note: The following floating-point exceptions are signalling: IEEE_INVALID_FLAG
STOP MPIFAKE: mpi_error_string

</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[12]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># Let us clean the present directory again:</span>
<span class="k">with</span> <span class="n">job</span> <span class="k">as</span> <span class="n">job</span><span class="p">:</span>
    <span class="n">job</span><span class="o">.</span><span class="n">clean</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
/Users/maximemoriniere/Documents/Python/MyBigDFT/doc/source/notebooks
</pre></div></div>
</div>
<p>It might happen that the error messages are not properly sent or received, depending on your platform (for instance with Bash on Ubuntu on Windows, under Windows 10). This might break this particulat behaviour, but you should still get an error. The error will however differ if running in dry mode or not.</p>
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="Convergences.html" class="btn btn-neutral float-right" title="Convergence classes" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="Input_files.html" class="btn btn-neutral float-left" title="Manipulate BigDFT input files" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2019, mmoriniere, OMalenfantThuot

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>